<!DOCTYPE html>
<html>
  <head>
    <META HTTP-EQUIV="PRAGMA" CONTENT="NO-CACHE">
    <META HTTP-EQUIV="EXPIRES" CONTENT="0">
    <META HTTP-EQUIV="CACHE-CONTROL" CONTENT="NO-CACHE">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>取得 Line User Profile</title>
  </head>
  <body>
    <div>
      <div id="result"></div>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
    <script>
      $(document).ready(function() {
        function initializeLiff(myLiffId) {
          liff
              .init({
                  liffId: myLiffId
              })
              .then(() => {
                  initializeApp();
              })
              .catch((err) => {
                  alert('啟動失敗。');
              });
      }

      function initializeApp() {
          /*var h = document.getElementById('result');
          h.innerHTML = 'Hello!!';*/
          liff.getProfile().then(profile => {
           
            var h = document.getElementById('result');
            h.innerHTML = profile.displayName;
            alert("done");
            postLineUserInfoDB();
          });
      }

      function postLineUserInfoDB() {
        var dataJSON = {
            user_name : profile.displayName,
            user_phone : '',
            user_type_id : '0',
            user_line_id : profile.userID
        };
       
        $.ajax({
          type: 'POST',
          dataType: 'json',
          url: 'http://fd0f-59-127-225-208.ngrok.io/registeruser',
          data: JSON.stringify(dataJSON),
          contentType: "application/json;charset=utf-8",
          success: function(res){       
            console.log(res.return)
          },
          error: function(){
                //your code here
            console.log('error');
          }
        })
      }
     
      //使用 LIFF_ID 初始化 LIFF 應用
      initializeLiff('1656766863-o95r3dj1');
      });
    </script>
  </body>
</html>
