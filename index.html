<!DOCTYPE html>
<html>
   <head>
      <title>Distance Matrix Service</title>
      <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
      <!-- jsFiddle will insert css and js -->
    </head>
  <style>
      /* Optional: Makes the sample page fill the window. */
      html,
      body {
      height: 100%;
      margin: 0;
      padding: 0;
      }

      #container {
      height: 100%;
      display: flex;
      }

      #sidebar {
      flex-basis: 15rem;
      flex-grow: 1;
      padding: 1rem;
      max-width: 30rem;
      height: 100%;
      box-sizing: border-box;
      overflow: auto;
      }

      #map {
      flex-basis: 0;
      flex-grow: 4;
      height: 100%;
      }

      #sidebar {
      flex-direction: column;
      }
  </style>
 <body>
   <div id="container">
      <div id="map"></div>
      <div id="sidebar">
        <h3 style="flex-grow: 0">Request</h3>
        <pre style="flex-grow: 1" id="request"></pre>
        <h3 style="flex-grow: 0">Response</h3>
        <pre style="flex-grow: 1" id="response"></pre>
      </div>
    </div>

   <!-- Async script executes immediately and must be after any DOM elements used in callback. -->
   <script
     src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB41DRUbKWJHPxaFjMAwdrzWzbVKartNGg&callback=initMap&v=weekly&channel=2"
     async
   ></script>
 </body>
  <script>
      function initMap() {
         const bounds = new google.maps.LatLngBounds();
         const markersArray = [];
         const map = new google.maps.Map(document.getElementById("map"), {
            center: { lat: 55.53, lng: 9.4 },
            zoom: 10,
         });
         // initialize services
         const geocoder = new google.maps.Geocoder();
         const service = new google.maps.DistanceMatrixService();
         // build request
         const origin1 = { lat: 25.018759, lng:121.564000}; //25.018759, 121.564000
        
         const destinationA = { lat: 25.021166, lng:121.554298}; //25.021166145625436, 121.5542989052452
       
         const request = {
            origins: [origin1],
            destinations: [destinationA],
            travelMode: google.maps.TravelMode.DRIVING,
            unitSystem: google.maps.UnitSystem.METRIC,
            avoidHighways: false,
            avoidTolls: false,
         };
            // Instantiate a directions service.
         const directionsService = new google.maps.DirectionsService();
            // Create a renderer for directions and bind it to the map.
         const directionsRenderer = new google.maps.DirectionsRenderer({ map: map });
         // Instantiate an info window to hold step text.
         const stepDisplay = new google.maps.InfoWindow();
         
         
         // put request on page
         document.getElementById("request").innerText = JSON.stringify(
            request,
            null,
            2
         );
         // get distance matrix response
         service.getDistanceMatrix(request).then((response) => {
            // put response
            document.getElementById("response").innerText = JSON.stringify(
               response,
               null,
               2
            );

            // show on map
            const originList = response.originAddresses;
            const destinationList = response.destinationAddresses;

            
            calculateAndDisplayRoute(
               directionsRenderer,
               directionsService,
               markersArray,
               stepDisplay,
               map,
               originList[0],
               destinationList[0]
            );
            
         });
         }
         //刪除所有 Markers
         function deleteMarkers(markersArray) {
         for (let i = 0; i < markersArray.length; i++) {
            markersArray[i].setMap(null);
         }
         markersArray = [];
         }
         //為每個 Marker 新增註解
         function attachInstructionText(stepDisplay, marker, text, map) {
         google.maps.event.addListener(marker, "click", () => {
            // Open an info window when the marker is clicked on, containing the text
            // of the step.
            stepDisplay.setContent(text);
            stepDisplay.open(map, marker);
         });
         }

         function calculateAndDisplayRoute(
         directionsRenderer,
         directionsService,
         markersArray,
         stepDisplay,
         map,
         origins,
         destinations
         ) {
         // First, remove any existing markers from the map.
         deleteMarkers(markersArray);

         // Retrieve the start and end locations and create a DirectionsRequest using
         // WALKING directions.
         directionsService
            .route({
               origin: origins,
               destination: destinations,
               travelMode: google.maps.TravelMode.WALKING,
            })
            .then((result) => {

               directionsRenderer.setDirections(result);

            })
            .catch((e) => {
               window.alert("Directions request failed due to " + e);
            });
      }
  </script>
</html>
